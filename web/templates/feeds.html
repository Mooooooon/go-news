<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢é˜…æºç®¡ç† - go-news</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav>
        <a href="/articles?status=processed">ğŸ“° æ–‡ç« </a>
        <a href="/feeds">ğŸ“¡ è®¢é˜…æº</a>
        <a href="/settings">âš™ï¸ è®¾ç½®</a>
        <a href="/status">ğŸ“Š çŠ¶æ€</a>
    </nav>
    <main>
        <div class="feeds-page">
            <h2>è®¢é˜…æºç®¡ç†</h2>

            <form id="add-feed-form" onsubmit="addFeed(event)">
                <input type="text" name="name" placeholder="åç§°" required>
                <input type="url" name="url" placeholder="RSS URL" required>
                <button type="submit">æ·»åŠ </button>
            </form>

            <div class="feeds-list">
                {{range .feeds}}
                <div class="feed-item" data-id="{{.ID}}">
                    <span class="name">{{.Name}}</span>
                    <span class="url">{{.URL}}</span>
                    <button onclick="fetchFeed({{.ID}})">æŠ“å–</button>
                    <button onclick="deleteFeed({{.ID}})">åˆ é™¤</button>
                </div>
                {{end}}
            </div>
        </div>
    </main>

    <script>
    async function addFeed(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
            name: form.name.value,
            url: form.url.value
        };

        await fetch('/api/feeds', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        location.reload();
    }

    async function fetchFeed(id) {
        const resp = await fetch(`/api/feeds/${id}/fetch`, {method: 'POST'});
        const data = await resp.json();
        alert(`æŠ“å–å®Œæˆ,æ–°å¢ ${data.new_articles} ç¯‡æ–‡ç« `);
    }

    async function deleteFeed(id) {
        if (!confirm('ç¡®å®šåˆ é™¤?')) return;
        await fetch(`/api/feeds/${id}`, {method: 'DELETE'});
        location.reload();
    }
    </script>
</body>
</html>
